<!DOCTYPE html>
<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
        integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.js"></script>
<script src="https://unpkg.com/@turf/turf@6/turf.min.js"></script>

<style>
    #messagePopup {
        display: none;
        justify-content: center;
        align-items: center;
        height: 100vh;
        width: 100vw;
        background-color: rgba(0, 0, 0, 0.4);
        position: absolute;
        top: 0;
        bottom: 0;
        right: 0;
        left: 0;
        z-index: 10000;
        font-size: 24px;
    }

    #messagePopup #messagePopupText {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background-color: #ffffff;
        padding: 20px;
        gap: 20px;
    }

    #messagePopup #messagePopupText button {
        padding: 20px;
    }

    #content {
        display: flex;
        flex-direction: column;
        height: 100vh;
    }

    #content #header {
        flex: 0 0 auto;
    }

    #map {
        flex: 1 1 auto;
    }
</style>

<div id="messagePopup">
    <div id="messagePopupText">
        <p>Dépêche toi!!!</p>
        <button onclick="document.getElementById('messagePopup').style.display = 'none';">X</button>
    </div>
</div>

<div id="content">
    <div id="header"></div>
    <div id="map"></div>
</div>

<script type="text/javascript">
    var messageTimeout = setTimeout(() => {
        document.getElementById('messagePopup').style.display = 'flex';
    }, 10000);

    function InitialiserCarte() {
        var map = L.map('map').setView([
            48.8626304852, 2.33629344655
        ], 6);

        // var tuileUrl = 'https://server.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}';
        var tuileUrl = 'https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png';

        var osm = L.tileLayer(tuileUrl, {
            minZoom: 0,
            maxZoom: 17
        });

        osm.addTo(map);

        const vienneGeoJson = {
            'type': 'Feature',
            'properties': { 'name': 'Vienne' },
            'geometry': {
                'type': 'Polygon',
                'coordinates': [[
                    [0.043, 46.984],
                    [0.498, 47.035],
                    [0.835, 46.862],
                    [0.916, 46.478],
                    [0.687, 46.212],
                    [0.243, 46.189],
                    [-0.086, 46.394],
                    [-0.091, 46.718],
                    [0.043, 46.984]
                ]]
            }
        };

        new L.GeoJSON.AJAX(['https://raw.githubusercontent.com/gregoiredavid/france-geojson/master/departements-version-simplifiee.geojson'], {})
            .addTo(map);

        map.on('click', function(e) {
            const lat = e.latlng.lat;
            const lng = e.latlng.lng;

            // Create a Turf point
            const point = turf.point([lng, lat]);

            // Check if inside Vienne
            const inside = turf.booleanPointInPolygon(point, vienneGeoJson);

            if (inside) {
                if (messageTimeout) {
                    clearTimeout(messageTimeout);
                }

                var videoWidth = window.screen.width;
                var videoHeight = videoWidth / 16 * 9;
                var popLocation = e.latlng;

                L.popup({ maxWidth: videoWidth })
                    .setLatLng(popLocation)
                    .setContent('<iframe width="' + videoWidth + '" height="' + videoHeight + '" src="https://www.youtube-nocookie.com/embed/lJ6coOOoD3c?si=N1bEcJhZBtuLHCUm&rel=0&autoplay=1" title="YouTube video player"\n' +
                        '        frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"\n' +
                        '        referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>')
                    .openOn(map);
            }
        });
    }

    $(document).ready(function() {
        InitialiserCarte();
    });</script>
</div>

</script>
</body>

</html>
